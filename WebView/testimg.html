
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="ja" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
  </head>
  <body style="background-color:transparent;">
    <canvas id="canvassample" width="500" height="500"></canvas>
    <script>
    var imgObjects = []; 
    var ctx = null;
    const height = 500;
    const width = 500;
    onload = function() {
      imgObjects.push(new WVImageTextObject());
      setupContext();
      setInterval(redrawAll, 18);
      setInterval(autoCoordinate, 18) //remove for actual implementation

    };

//-----------------WVImageObject--------------------------------------
    function WVImageTextObject() {
        this.initialize.apply(this, arguments);
    }

    WVImageTextObject.prototype.initialize = function() {
      this.x = 0;
      this.y = 0;
      this.text = "";
      this.img = new Image();

      //for motion
      this.targetx = 0;
      this.targety = 0;
      this.mobileFrame = 0;
    };

    WVImageTextObject.prototype.redraw = function() {
      if (this.mobileFrame > 0)
      {
        var xDelta = (this.targetx - this.x) / this.mobileFrame;
        var yDelta = (this.targety - this.y) / this.mobileFrame;
        this.x += xDelta;
        this.y += yDelta;
        this.mobileFrame --;
        console.log(this.mobileFrame);
      }
      ctx.drawImage(this.img, this.x, this.y);
      ctx.fillText(this.text,this.x + 34,this.y + 50);
    };

    //For external call
    //object consist of {x,y,text,src}
    WVImageTextObject.prototype.setObject = function(object) {
      this.x = object.x;
      this.y = object.y;

      if (object.src)
      {
        this.img.src = object.src;
      }

      if (object.text)
      {
        this.text = object.text;
      }
    };

    //For external call
    //object consist of {x,y,text,src}
    WVImageTextObject.prototype.setObjectMotion = function(object) {
      this.targetx = object.x;
      this.targety = object.y;

      this.mobileFrame = 30;

      if (object.src)
      {
        this.img.src = object.src;
      }

      if (object.text)
      {
        this.text = object.text;
      }
    };

//---------------------Shared Functions-------------------------------------
    function setupContext() {
      var c = document.getElementById("canvassample");
      ctx = c.getContext('2d');
      ctx.font = "16px Arial";
    }

    //frame update
    function redrawAll()
    {
      ctx.clearRect(0, 0, height, width)
      imgObjects.forEach(function(element) {
        element.redraw();
      }, this);
    }


    //testing coordinate function
    function autoCoordinate()
    {
      var tempx = imgObjects[0].x + 5;
      var tempy = imgObjects[0].y;
      if (imgObjects[0].x > 500)
      {
        tempy = imgObjects[0].y + 10;
        tempx = 0;
      }
      if (imgObjects[0].y > 500)
      {
        tempy[0] = 0;
      }

      //Object example
      var iobj = {}
      iobj.x = tempx;
      iobj.y = tempy;
      iobj.text = "text"
      iobj.src = "image1.png"
      imgObjects[0].setObject(iobj);


      //Second one
      if (imgObjects.length < 2)
      {
        imgObjects.push(new WVImageTextObject());
        //Object example
        var iobj = {}
        iobj.x = 400;
        iobj.y = 300;
        iobj.text = "Motion"
        iobj.src = "image1.png"
        imgObjects[1].setObjectMotion(iobj);
      }
    }
  </script>
  </body>
</html>

